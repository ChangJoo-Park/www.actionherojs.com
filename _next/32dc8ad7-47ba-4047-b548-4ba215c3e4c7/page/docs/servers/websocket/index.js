
          window.__NEXT_REGISTER_PAGE('/docs/servers/websocket', function() {
            var comp = module.exports=webpackJsonp([10],{1248:function(e,t,l){e.exports=l(1249)},1249:function(e,t,l){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=l(9),c=n(a),o=l(1),r=n(o),i=l(8),u=n(i),s=l(2),d=n(s),m=l(3),f=n(m),E=l(0),h=n(E),g=l(16),p=n(g),w=l(11),b=l(14),v=n(b),k=l(18),y=n(k),S=function(e){function t(e){(0,r.default)(this,t);var l=(0,d.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return l.state={titleSection:{title:"Servers: Web Socket",icon:"/static/images/real-time-chat.svg"},sections:{overview:"Overview","connection-details":"Connection Details","client-methods":"Client Methods","client-events":"Client Events","link-web-websocket":"Linking WebSockets to Web Clients","config-options":"Config Options"},links:[{link:"/docs/servers/socket",title:"» Servers: Socket"},{link:"/docs/servers/web",title:"« Servers: Web"}]},l}return(0,f.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){return h.default.createElement(v.default,{sideNav:this.state.sections,titleSection:this.state.titleSection,links:this.state.links,currentSection:this.state.currentSection},h.default.createElement(w.Row,null,h.default.createElement(w.Col,{md:12},this.section("overview",h.default.createElement("div",null,h.default.createElement("p",null,"ActionHero uses ",h.default.createElement("a",{href:"https://github.com/primus/primus"},"Primus")," for web sockets.  The Primus project allows you to choose from many websocket backends, including ",h.default.createElement("code",null,"ws"),", ",h.default.createElement("code",null,"engine.io"),", ",h.default.createElement("code",null,"socket.io"),", and more. Within ActionHero, web sockets are bound to the web server (either http or https)."),h.default.createElement("p",null,"ActionHero will generate the client-side javascript needed for you (based on the actionheroClient library, primus, and the underlying ws transport). This file is regenerated each time you boot the application."))),this.section("connection-details",h.default.createElement("div",null,h.default.createElement(y.default,null,"// In the Browser...\n<script src=\"/public/javascript/actionheroClient.js\"><\/script>\n\n<script>\n\n  client = new ActionheroClient;\n\n  client.on('connected',    function(){ console.log('connected!') })\n  client.on('disconnected', function(){ console.log('disconnected :(') })\n\n  client.on('error',        function(error){ console.log('error', error.stack) })\n  client.on('reconnect',    function(){ console.log('reconnect') })\n  client.on('reconnecting', function(){ console.log('reconnecting') })\n\n  // this will log all messages send the client\n  // client.on('message',      function(message){ console.log(message) })\n\n  client.on('alert',        function(message){ alert(message) })\n  client.on('api',          function(message){ alert(message) })\n\n  client.on('welcome',      function(message){ appendMessage(message); })\n  client.on('say',          function(message){ appendMessage(message); })\n\n  client.connect(function(error, details){\n    if(error != null){\n      console.log(error);\n    }else{\n      client.roomAdd(\"defaultRoom\");\n      client.action('someAction', {key: 'k', value: 'v'}, function(error, data){\n        // do stuff\n      });\n    }\n  });\n\n<\/script>"),h.default.createElement("p",null,h.default.createElement("code",null,"connection.type"),' for a webSocket client is "webSocket".  This type will not change regardless of if the client has fallen back to another protocol.'),h.default.createElement("p",null,"Data is always returned as JSON objects to the webSocket client."),h.default.createElement("p",null,"An example web socket session might be the following:"),h.default.createElement("p",null,"You can also inspect ",h.default.createElement("code",null,"client.state")," (‘connected', ‘disconnected', etc).  The websocket client will attempt to re-connect automatically."),h.default.createElement("p",null,"If you want to communicate with a websocket client outside of an action, you can call ",h.default.createElement("code",null,"connection.send(message)")," on the server. In the client lib, the event message will be fired. So, ",h.default.createElement("code",null,"client.on('message, function(m){ ... })"),".  Be sure to add some descriptive content to the message you send from the sever (like perhaps ",h.default.createElement("code",null,"{\"type\": 'message type'}"),") so you can route message types on the client."))),this.section("client-methods",h.default.createElement("div",null,h.default.createElement("p",null,"Methods which an ActionHero Client instance provider are:"),h.default.createElement("h3",null,h.default.createElement("code",null,"client.connect(callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"callback")," will contain (error, details)"),h.default.createElement("li",null,"details here is the same as the ",h.default.createElement("code",null,"detailsView")," method")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.action(action, params, callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"action"),' is a string, like "login"'),h.default.createElement("li",null,h.default.createElement("code",null,"params")," is an object"),h.default.createElement("li",null,h.default.createElement("code",null,"callback")," will be passed ",h.default.createElement("code",null,"response")," (and you can inspect ",h.default.createElement("code",null,"response.error"),")")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.say(room, message, callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"message")," is a string"),h.default.createElement("li",null,"may contain an ",h.default.createElement("code",null,"error")),h.default.createElement("li",null,"note that you have to first join a room with ",h.default.createElement("code",null,"roomAdd")," to chat within it of recieve events")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.detailsView(callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"callback")," will be passed ",h.default.createElement("code",null,"error"),", ",h.default.createElement("code",null,"response")),h.default.createElement("li",null,"the first response from detailsView will also always be saved to ",h.default.createElement("code",null,"client.details")," for later inspection"),h.default.createElement("li",null,"may contain an ",h.default.createElement("code",null,"error"))),h.default.createElement("h3",null,h.default.createElement("code",null,"client.roomView(room, callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,"will return metadata about the room"),h.default.createElement("li",null,"may contain an ",h.default.createElement("code",null,"error"))),h.default.createElement("h3",null,h.default.createElement("code",null,"client.roomAdd(room, callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"room")," is a string"),h.default.createElement("li",null,"may contain an ",h.default.createElement("code",null,"error"))),h.default.createElement("h3",null,h.default.createElement("code",null,"client.roomLeave(room, callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,h.default.createElement("code",null,"room")," is a string"),h.default.createElement("li",null,"may contain an ",h.default.createElement("code",null,"error"))),h.default.createElement("h3",null,h.default.createElement("code",null,"client.file(callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,"see below for details")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.disconnect()")),h.default.createElement("ul",null,h.default.createElement("li",null,"instantly sever the connection to the server")),h.default.createElement("p",null,"The contents of the ",h.default.createElement("code",null,"file")," callback look like:"),h.default.createElement(y.default,null,'{\n  content: "<h1>ActionHero</h1>\nI am a flat file being served to you via the API from ./public/simple.html<br />",\n  context: "response",\n  error: null,\n  length: 101,\n  messageCount: 3,\n  mime: "text/html"\n}'))),this.section("client-events",h.default.createElement("div",null,h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘connected', callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,"no event data")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘disconnected', callback)")),h.default.createElement("ul",null,h.default.createElement("li",null,"no event data")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘error', (error) => { console.log(‘error', error.stack) })")),h.default.createElement("ul",null,h.default.createElement("li",null,"this is fired when a general error is encountered (outside of an action or verb)"),h.default.createElement("li",null,"this may fire when a general server error occurs")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘reconnect', () => { console.log(‘reconnect') })")),h.default.createElement("ul",null,h.default.createElement("li",null,"fired when client has reconnected"),h.default.createElement("li",null,"this will indicate that details, connection.id and other server-generated settings may have changed")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘reconnecting', callback })")),h.default.createElement("ul",null,h.default.createElement("li",null,"client is attempting to reconnect to server")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘message', (message) => { console.log(message) })")),h.default.createElement("ul",null,h.default.createElement("li",null,"this is VERY noisy, and is fired on all messages from the server, regardless of context or callback")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘alert', (message) => { alert(message) })")),h.default.createElement("ul",null,h.default.createElement("li",null,"fired when message recieved from the server's context is specifically ",h.default.createElement("code",null,"alert"))),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘api', (message) => { alert(message) })")),h.default.createElement("ul",null,h.default.createElement("li",null,"fired when message recieved from the server's context is unknown or from the server")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘welcome', (message) => { console.log(message); })")),h.default.createElement("ul",null,h.default.createElement("li",null,"server's welcome message")),h.default.createElement("h3",null,h.default.createElement("code",null,"client.on(‘say', (message) => { console.log(message); })")),h.default.createElement("ul",null,h.default.createElement("li",null,"fired on all say messages from other clients in all rooms"),h.default.createElement("li",null,"message.room can be inspected")))),this.section("link-web-websocket",h.default.createElement("div",null,h.default.createElement("p",null,"ActionHero provides ",h.default.createElement("code",null,"connection.fingerprint")," where available to help you link websocket connections to related web connections. While every connection will always have a unique ",h.default.createElement("code",null,"connection.id"),", we attempt to build ",h.default.createElement("code",null,"connection.fingerprint")," by checking the headers the websocket connection began with.  If the cookie defined by ",h.default.createElement("code",null,"api.config.servers.web.fingerprint.cookieKey")," is present, we will store its value on the websocket connection."),h.default.createElement("p",null,"You can read more about using a value like ",h.default.createElement("code",null,"connection.fingerprint")," in an ",h.default.createElement("a",{href:"/docs/core/middleware"},"authentication middleware")," or using it as a key for session information."))),this.section("config-options",h.default.createElement("div",null,h.default.createElement(y.default,null,"exports['default'] = {\n  servers: {\n    websocket: function (api) {\n      return {\n        enabled: true,\n        // you can pass a FQDN (string) here or 'window.location.origin'\n        clientUrl: 'window.location.origin',\n        // Directory to render client-side JS.\n        // Path should start with \"/\" and will be built starting from api.config..general.paths.public\n        clientJsPath: 'javascript/',\n        // the name of the client-side JS file to render.  Both `.js` and `.min.js` versions will be created\n        // do not include the file exension\n        // set to `undefined` to not render the client-side JS on boot\n        clientJsName: 'actionheroClient',\n        // should the server signal clients to not reconnect when the server is shutdown/reboot\n        destroyClientsOnShutdown: false,\n\n        // websocket Server Options:\n        server: {\n          // authorization: null,\n          // pathname:      '/primus',\n          // parser:        'JSON',\n          // transformer:   'websockets',\n          // plugin:        {},\n          // timeout:       35000,\n          // origins:       '*',\n          // methods:       ['GET','HEAD','PUT','POST','DELETE','OPTIONS'],\n          // credentials:   true,\n          // maxAge:        '30 days',\n          // exposed:       false,\n        },\n\n        // websocket Client Options:\n        client: {\n          apiPath: '/api' // the api base endpoint on your actionhero server\n          // reconnect:        {},\n          // timeout:          10000,\n          // ping:             25000,\n          // pong:             10000,\n          // strategy:         \"online\",\n          // manual:           false,\n          // websockets:       true,\n          // network:          true,\n          // transport:        {},\n          // queueSize:        Infinity,\n        }\n      }\n    }\n  }\n}"),h.default.createElement("p",null,"You can create your client with options.  Options for both the server and client are stored in ",h.default.createElement("code",null,"/config/servers/websocket.js"),".  Note there are 2 sections: ",h.default.createElement("code",null,"server")," and ",h.default.createElement("code",null,"client"),"."))))))}}]),t}(p.default);t.default=S}},[1248]);
            return { page: comp.default }
          })
        