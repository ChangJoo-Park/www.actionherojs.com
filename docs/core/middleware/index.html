<!DOCTYPE html><html><head><link rel="preload" href="/_next/e2246878-227f-4809-bcfe-8b4d3e2ec98c/page/docs/core/middleware/index.js" as="script"/><link rel="preload" href="/_next/e2246878-227f-4809-bcfe-8b4d3e2ec98c/page/_error/index.js" as="script"/><link rel="preload" href="/_next/517642acd6437ad7e589c92138f402c3/app.js" as="script"/><meta charset="utf-8" class="next-head"/><link rel="apple-touch-icon" sizes="57x57" href="/static/images/icons/apple-icon-57x57.png" class="next-head"/><link rel="apple-touch-icon" sizes="60x60" href="/static/images/icons/apple-icon-60x60.png" class="next-head"/><link rel="apple-touch-icon" sizes="72x72" href="/static/images/icons/apple-icon-72x72.png" class="next-head"/><link rel="apple-touch-icon" sizes="76x76" href="/static/images/icons/apple-icon-76x76.png" class="next-head"/><link rel="apple-touch-icon" sizes="114x114" href="/static/images/icons/apple-icon-114x114.png" class="next-head"/><link rel="apple-touch-icon" sizes="120x120" href="/static/images/icons/apple-icon-120x120.png" class="next-head"/><link rel="apple-touch-icon" sizes="144x144" href="/static/images/icons/apple-icon-144x144.png" class="next-head"/><link rel="apple-touch-icon" sizes="152x152" href="/static/images/icons/apple-icon-152x152.png" class="next-head"/><link rel="apple-touch-icon" sizes="180x180" href="/static/images/icons/apple-icon-180x180.png" class="next-head"/><link rel="icon" type="image/png" sizes="192x192" href="/static/images/icons/android-icon-192x192.png" class="next-head"/><link rel="icon" type="image/png" sizes="32x32" href="/static/images/icons/favicon-32x32.png" class="next-head"/><link rel="icon" type="image/png" sizes="96x96" href="/static/images/icons/favicon-96x96.png" class="next-head"/><link rel="icon" type="image/png" sizes="16x16" href="/static/images/icons/favicon-16x16.png" class="next-head"/><meta name="viewport" content="width=device-width" class="next-head"/><link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css" class="next-head"/><link rel="stylesheet" type="text/css" href="/static/css/bebasNeue.css" class="next-head"/><link rel="stylesheet" type="text/css" href="/static/css/animations.css" class="next-head"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|Roboto:100,300,400,500,700,900" rel="stylesheet" class="next-head"/><title class="next-head">ActionHero</title><script src="/static/js/googleAnalytics.js" class="next-head"></script><link rel="stylesheet" href="https://unpkg.com/react-instantsearch-theme-algolia@4.0.0/style.min.css" class="next-head"/></head><body><div><div id="__next"><div data-reactroot="" data-reactid="1" data-react-checksum="-1327449071"><div data-reactid="2"><!-- react-empty: 3 --><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300;" class="container-fluid" data-reactid="4"><header style="background-color:#2F5266;" data-reactid="5"><div class="container" data-reactid="6"><nav style="background-color:#2F5266;padding-top:5px;margin-bottom:10px;border:0;" class="navbar navbar-default" data-reactid="7"><div class="container" data-reactid="8"><div class="navbar-header" data-reactid="9"><a style="padding-top:0;margin-bottom:15px;" class="navbar-brand" data-reactid="10"><img src="/static/images/actionhero-logo-header-wordmark.svg" style="padding-top:14px;padding-bottom:20px;" data-reactid="11"/></a><button type="button" class="navbar-toggle collapsed" data-reactid="12"><span class="sr-only" data-reactid="13">Toggle navigation</span><span class="icon-bar" data-reactid="14"></span><span class="icon-bar" data-reactid="15"></span><span class="icon-bar" data-reactid="16"></span></button></div><div class="navbar-collapse collapse" data-reactid="17"><ul class="nav navbar-nav navbar-right" data-reactid="18"></ul><ul class="hidden-md hidden-sm hidden-xs nav navbar-nav navbar-left" data-reactid="19"><li role="presentation" class="" data-reactid="20"><a role="button" href="#" data-reactid="21"> </a></li><li role="presentation" class="" data-reactid="22"><a role="button" href="#" data-reactid="23"> </a></li><li role="presentation" class="" data-reactid="24"><a role="button" href="#" data-reactid="25"> </a></li><li role="presentation" class="" data-reactid="26"><a role="button" href="#" data-reactid="27"> </a></li></ul><ul class="nav navbar-nav navbar-left" data-reactid="28"><li role="presentation" class="" data-reactid="29"><a role="button" href="#" data-reactid="30"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;" data-reactid="31">Downloads</span></a></li><li role="presentation" class="" data-reactid="32"><a role="button" href="#" data-reactid="33"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;" data-reactid="34">Documentation</span></a></li><li role="presentation" class="hidden-sm" data-reactid="35"><a role="button" href="#" data-reactid="36"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;" data-reactid="37">Solutions</span></a></li><li role="presentation" class="" data-reactid="38"><a role="button" href="#" data-reactid="39"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;" data-reactid="40">Community</span></a></li></ul><ul class="nav navbar-nav navbar-right" data-reactid="41"><div data-reactid="42"><a style="text-decoration:none;" href="/get-started/" data-reactid="43"><button style="font-family:Roboto, sans-serif;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#6E8898;border-color:#6E8898;font-weight:300;margin-top:20px;margin-bottom:0;margin-left:10px;margin-right:10px;outline:none;" type="button" class="btn btn-lg btn-default btn-block" data-reactid="44">Get Started</button></a></div></ul></div></div></nav></div></header></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300;" class="container-fluid" data-reactid="45"><div style="background-color:#FBF9E4;color:#2F5266;font-weight:200;padding:50px;" data-reactid="46"><div class="container" data-reactid="47"><div class="row" data-reactid="48"><div style="text-align:center;" class="col-md-3" data-reactid="49"><img src="/static/images/api-first-development.svg" data-reactid="50"/></div><div style="text-align:center;" class="col-md-6" data-reactid="51"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px;" data-reactid="52"><br data-reactid="53"/><!-- react-text: 54 -->Core: Middleware<!-- /react-text --></h1></div><div class="col-md-3" data-reactid="55"></div></div></div></div><div style="height:183px;background:url(&quot;/static/images/clouds-white.svg&quot;) no-repeat center #FBF9E4;" data-reactid="56"></div><div style="padding-bottom:100px;" class="container" data-reactid="57"><div class="row" data-reactid="58"><div id="_top" data-reactid="59"></div><div id="docPageContent" class="col-md-9" data-reactid="60"><div class="row" data-reactid="61"><div class="col-md-12" data-reactid="62"><div data-reactid="63"><br data-reactid="64"/><h2 id="overview" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="65"><span style="font-weight:300;font-size:36px;" data-reactid="66">Overview</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="67"/><div style="font-family:Open Sans, sans-serif;" data-reactid="68"><div data-reactid="69"><p data-reactid="70">There are 4 types of middleware in ActionHero:</p><ul data-reactid="71"><li data-reactid="72"><strong data-reactid="73">Action</strong></li><li data-reactid="74"><strong data-reactid="75">Connection</strong></li><li data-reactid="76"><strong data-reactid="77">Chat</strong></li><li data-reactid="78"><strong data-reactid="79">Task</strong></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="80"><code data-reactid="81"><!-- react-text: 82 -->&gt; Client **Connects**
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="83"><!-- react-text: 84 -->#     connection middleware, `create` hook<!-- /react-text --></span><!-- react-text: 85 -->
&gt; Client requests an **action**
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="86"><!-- react-text: 87 -->#     action middleware, `preProcessor` hook<!-- /react-text --></span><!-- react-text: 88 -->
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="89"><!-- react-text: 90 -->#     action middleware, `postProcessor` hook<!-- /react-text --></span><!-- react-text: 91 -->
&gt; Client **joins a room**
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="92"><!-- react-text: 93 -->#     chat middleware, `join` hook<!-- /react-text --></span><!-- react-text: 94 -->
&gt; Client **says a message** <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="95"><!-- react-text: 96 -->in<!-- /react-text --></span><!-- react-text: 97 --> a room
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="98"><!-- react-text: 99 -->#     chat middleware, `say` hook<!-- /react-text --></span><!-- react-text: 100 -->
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="101"><!-- react-text: 102 -->#     chat middleware, `onSayReceive` hook<!-- /react-text --></span><!-- react-text: 103 -->
&gt; Client requests a **disconnect** (quit)
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="104"><!-- react-text: 105 -->#     chat middleware, `leave` hook<!-- /react-text --></span><!-- react-text: 106 -->
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="107"><!-- react-text: 108 -->#     connection middleware, `destroy` hook<!-- /react-text --></span><!-- react-text: 109 -->
&gt; Client executes a **task**
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="110"><!-- react-text: 111 -->#     task middleware, `preProcessor` hook<!-- /react-text --></span><!-- react-text: 112 -->
<!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="113"><!-- react-text: 114 -->#     task middleware, `postProcessor` hook<!-- /react-text --></span><!-- react-text: 115 -->
<!-- /react-text --></code></pre><p data-reactid="116">Each type of middleware is distinct from the others, and operates on distinct parts of a client&#x27;s lifecycle.  For a logical example, please inspect the following connection lifecycle:</p></div></div></div><div data-reactid="117"><br data-reactid="118"/><h2 id="action-request-flow" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="119"><span style="font-weight:300;font-size:36px;" data-reactid="120">Action Request Flow</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="121"/><div style="font-family:Open Sans, sans-serif;" data-reactid="122"><div data-reactid="123"><img width="100%" src="/static/images/connection_flow_actions.png" data-reactid="124"/></div></div></div><div data-reactid="125"><br data-reactid="126"/><h2 id="action-middleware" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="127"><span style="font-weight:300;font-size:36px;" data-reactid="128">Action Middleware</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="129"/><div style="font-family:Open Sans, sans-serif;" data-reactid="130"><div data-reactid="131"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="132"><code data-reactid="133"><span style="color:#333;font-weight:bold;" data-reactid="134"><!-- react-text: 135 -->var<!-- /react-text --></span><!-- react-text: 136 --> middleware = {
  <!-- /react-text --><span data-reactid="137"><!-- react-text: 138 -->name<!-- /react-text --></span><!-- react-text: 139 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="140"><!-- react-text: 141 -->&#x27;userId checker&#x27;<!-- /react-text --></span><!-- react-text: 142 -->,
  <!-- /react-text --><span data-reactid="143"><!-- react-text: 144 -->global<!-- /react-text --></span><!-- react-text: 145 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="146"><!-- react-text: 147 -->false<!-- /react-text --></span><!-- react-text: 148 -->,
  <!-- /react-text --><span data-reactid="149"><!-- react-text: 150 -->priority<!-- /react-text --></span><!-- react-text: 151 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="152"><!-- react-text: 153 -->1000<!-- /react-text --></span><!-- react-text: 154 -->,
  <!-- /react-text --><span data-reactid="155"><!-- react-text: 156 -->preProcessor<!-- /react-text --></span><!-- react-text: 157 -->: <!-- /react-text --><span data-reactid="158"><span style="color:#333;font-weight:bold;" data-reactid="159"><!-- react-text: 160 -->function<!-- /react-text --></span><!-- react-text: 161 -->(<!-- /react-text --><span data-reactid="162"><!-- react-text: 163 -->data, next<!-- /react-text --></span><!-- react-text: 164 -->)<!-- /react-text --></span><!-- react-text: 165 -->{
    <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="166"><!-- react-text: 167 -->if<!-- /react-text --></span><!-- react-text: 168 -->(!data.params.userId){
      next(<!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="169"><!-- react-text: 170 -->new<!-- /react-text --></span><!-- react-text: 171 --> <!-- /react-text --><span style="color:#0086b3;" data-reactid="172"><!-- react-text: 173 -->Error<!-- /react-text --></span><!-- react-text: 174 -->(<!-- /react-text --><span style="color:#d14;" data-reactid="175"><!-- react-text: 176 -->&#x27;All actions require a userId&#x27;<!-- /react-text --></span><!-- react-text: 177 -->) );
    }<!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="178"><!-- react-text: 179 -->else<!-- /react-text --></span><!-- react-text: 180 -->{
      next();
    }
  },
  <!-- /react-text --><span data-reactid="181"><!-- react-text: 182 -->postProcessor<!-- /react-text --></span><!-- react-text: 183 -->: <!-- /react-text --><span data-reactid="184"><span style="color:#333;font-weight:bold;" data-reactid="185"><!-- react-text: 186 -->function<!-- /react-text --></span><!-- react-text: 187 -->(<!-- /react-text --><span data-reactid="188"><!-- react-text: 189 -->data, next<!-- /react-text --></span><!-- react-text: 190 -->)<!-- /react-text --></span><!-- react-text: 191 -->{
    <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="192"><!-- react-text: 193 -->if<!-- /react-text --></span><!-- react-text: 194 -->(data.thing.stuff == <!-- /react-text --><span style="color:#008080;" data-reactid="195"><!-- react-text: 196 -->false<!-- /react-text --></span><!-- react-text: 197 -->){
      data.toRender = <!-- /react-text --><span style="color:#008080;" data-reactid="198"><!-- react-text: 199 -->false<!-- /react-text --></span><!-- react-text: 200 -->;
    }
    next(error);
  }
}

api.actions.addMiddleware(middleware);<!-- /react-text --></code></pre><p data-reactid="201">ActionHero provides hooks for you to execute custom code both before and after the execution of all or some actions.  This is a great place to write authentication logic or custom loggers.</p><p data-reactid="202"><!-- react-text: 203 -->Action middleware requires a <!-- /react-text --><code data-reactid="204">name</code><!-- react-text: 205 --> and at least one of <!-- /react-text --><code data-reactid="206">preProcessor</code><!-- react-text: 207 --> or <!-- /react-text --><code data-reactid="208">postProcessor</code><!-- react-text: 209 -->.  Middleware can be <!-- /react-text --><code data-reactid="210">global</code><!-- react-text: 211 -->, or you can choose to apply each middleware to an action specifically via <!-- /react-text --><code data-reactid="212">action.middleware = []</code><!-- react-text: 213 --> in the action&#x27;s definition.  You supply a list of middleware names, like <!-- /react-text --><code data-reactid="214">action.middleware = [&#x27;userId checker&#x27;]</code><!-- react-text: 215 --> in the example above.<!-- /react-text --></p><p data-reactid="216"><!-- react-text: 217 -->Each processor is passed <!-- /react-text --><code data-reactid="218">data</code><!-- react-text: 219 --> and the callback <!-- /react-text --><code data-reactid="220">next</code><!-- react-text: 221 -->.  Just like within actions, you can modify the <!-- /react-text --><code data-reactid="222">data</code><!-- react-text: 223 --> object to add to <!-- /react-text --><code data-reactid="224">data.response</code><!-- react-text: 225 --> to create a response to the client.  If you pass <!-- /react-text --><code data-reactid="226">error</code><!-- react-text: 227 --> to the callback <!-- /react-text --><code data-reactid="228">next</code><!-- react-text: 229 -->, that error will be returned to the client.  If a <!-- /react-text --><code data-reactid="230">preProcessor</code><!-- react-text: 231 --> has an error, the action will never be called.<!-- /react-text --></p><p data-reactid="232"><!-- react-text: 233 -->The priority of a middleware orders it with all other middleware which might fire for an action.  Lower numbers happen first.  If you do not provide a priority, the default from <!-- /react-text --><code data-reactid="234">api.config.general.defaultProcessorPriority</code><!-- react-text: 235 --> will be used<!-- /react-text --></p><h3 data-reactid="236">The Data Object</h3><p data-reactid="237"><code data-reactid="238">data</code><!-- react-text: 239 --> contains the same information as would be passed to an action:<!-- /react-text --></p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="240"><code data-reactid="241"><!-- react-text: 242 -->data = {
  <!-- /react-text --><span data-reactid="243"><!-- react-text: 244 -->connection<!-- /react-text --></span><!-- react-text: 245 -->: {},
  <!-- /react-text --><span data-reactid="246"><!-- react-text: 247 -->action<!-- /react-text --></span><!-- react-text: 248 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="249"><!-- react-text: 250 -->&#x27;randomNumber&#x27;<!-- /react-text --></span><!-- react-text: 251 -->,
  <!-- /react-text --><span data-reactid="252"><!-- react-text: 253 -->toProcess<!-- /react-text --></span><!-- react-text: 254 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="255"><!-- react-text: 256 -->true<!-- /react-text --></span><!-- react-text: 257 -->,
  <!-- /react-text --><span data-reactid="258"><!-- react-text: 259 -->toRender<!-- /react-text --></span><!-- react-text: 260 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="261"><!-- react-text: 262 -->true<!-- /react-text --></span><!-- react-text: 263 -->,
  <!-- /react-text --><span data-reactid="264"><!-- react-text: 265 -->messageCount<!-- /react-text --></span><!-- react-text: 266 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="267"><!-- react-text: 268 -->1<!-- /react-text --></span><!-- react-text: 269 -->,
  <!-- /react-text --><span data-reactid="270"><!-- react-text: 271 -->params<!-- /react-text --></span><!-- react-text: 272 -->: { <!-- /react-text --><span data-reactid="273"><!-- react-text: 274 -->action<!-- /react-text --></span><!-- react-text: 275 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="276"><!-- react-text: 277 -->&#x27;randomNumber&#x27;<!-- /react-text --></span><!-- react-text: 278 -->, <!-- /react-text --><span data-reactid="279"><!-- react-text: 280 -->apiVersion<!-- /react-text --></span><!-- react-text: 281 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="282"><!-- react-text: 283 -->1<!-- /react-text --></span><!-- react-text: 284 --> },
  <!-- /react-text --><span data-reactid="285"><!-- react-text: 286 -->missingParams<!-- /react-text --></span><!-- react-text: 287 -->: [],
  <!-- /react-text --><span data-reactid="288"><!-- react-text: 289 -->validatorErrors<!-- /react-text --></span><!-- react-text: 290 -->: [],
  <!-- /react-text --><span data-reactid="291"><!-- react-text: 292 -->actionStartTime<!-- /react-text --></span><!-- react-text: 293 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="294"><!-- react-text: 295 -->1429531553417<!-- /react-text --></span><!-- react-text: 296 -->,
  <!-- /react-text --><span data-reactid="297"><!-- react-text: 298 -->actionTemplate<!-- /react-text --></span><!-- react-text: 299 -->: {}, <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="300"><!-- react-text: 301 -->// the actual object action definition<!-- /react-text --></span><!-- react-text: 302 -->
  working: <!-- /react-text --><span style="color:#008080;" data-reactid="303"><!-- react-text: 304 -->true<!-- /react-text --></span><!-- react-text: 305 -->,
  <!-- /react-text --><span data-reactid="306"><!-- react-text: 307 -->response<!-- /react-text --></span><!-- react-text: 308 -->: {},
  <!-- /react-text --><span data-reactid="309"><!-- react-text: 310 -->duration<!-- /react-text --></span><!-- react-text: 311 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="312"><!-- react-text: 313 -->null<!-- /react-text --></span><!-- react-text: 314 -->,
  <!-- /react-text --><span data-reactid="315"><!-- react-text: 316 -->actionStatus<!-- /react-text --></span><!-- react-text: 317 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="318"><!-- react-text: 319 -->null<!-- /react-text --></span><!-- react-text: 320 -->,
}<!-- /react-text --></code></pre></div></div></div><div data-reactid="321"><br data-reactid="322"/><h2 id="connection-middleware" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="323"><span style="font-weight:300;font-size:36px;" data-reactid="324">Connection Middleware</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="325"/><div style="font-family:Open Sans, sans-serif;" data-reactid="326"><div data-reactid="327"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="328"><code data-reactid="329"><span style="color:#333;font-weight:bold;" data-reactid="330"><!-- react-text: 331 -->var<!-- /react-text --></span><!-- react-text: 332 --> connectionMiddleware = {
  <!-- /react-text --><span data-reactid="333"><!-- react-text: 334 -->name<!-- /react-text --></span><!-- react-text: 335 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="336"><!-- react-text: 337 -->&#x27;connection middleware&#x27;<!-- /react-text --></span><!-- react-text: 338 -->,
  <!-- /react-text --><span data-reactid="339"><!-- react-text: 340 -->priority<!-- /react-text --></span><!-- react-text: 341 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="342"><!-- react-text: 343 -->1000<!-- /react-text --></span><!-- react-text: 344 -->,
  <!-- /react-text --><span data-reactid="345"><!-- react-text: 346 -->create<!-- /react-text --></span><!-- react-text: 347 -->: <!-- /react-text --><span data-reactid="348"><span style="color:#333;font-weight:bold;" data-reactid="349"><!-- react-text: 350 -->function<!-- /react-text --></span><!-- react-text: 351 -->(<!-- /react-text --><span data-reactid="352"><!-- react-text: 353 -->connection<!-- /react-text --></span><!-- react-text: 354 -->)<!-- /react-text --></span><!-- react-text: 355 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="356"><!-- react-text: 357 -->// do stuff<!-- /react-text --></span><!-- react-text: 358 -->
  },
  <!-- /react-text --><span data-reactid="359"><!-- react-text: 360 -->destroy<!-- /react-text --></span><!-- react-text: 361 -->: <!-- /react-text --><span data-reactid="362"><span style="color:#333;font-weight:bold;" data-reactid="363"><!-- react-text: 364 -->function<!-- /react-text --></span><!-- react-text: 365 -->(<!-- /react-text --><span data-reactid="366"><!-- react-text: 367 -->connection<!-- /react-text --></span><!-- react-text: 368 -->)<!-- /react-text --></span><!-- react-text: 369 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="370"><!-- react-text: 371 -->// do stuff<!-- /react-text --></span><!-- react-text: 372 -->
  }
};

api.connections.addMiddleware(connectionMiddleware);<!-- /react-text --></code></pre><p data-reactid="373">Like the action middleware above, you can also create middleware to react to the creation or destruction of all connections.  Unlike action middleware, connection middleware is non-blocking and connection logic will continue as normal regardless of what you do in this type of middleware.</p><p data-reactid="374"><!-- react-text: 375 -->Keep in mind that some connections persist (webSocket, socket) and some only exist for the duration of a single request (web).  You will likely want to inspect <!-- /react-text --><code data-reactid="376">connection.type</code><!-- react-text: 377 --> in this middleware.  Again, if you do not provide a priority, the default from <!-- /react-text --><code data-reactid="378">api.config.general.defaultProcessorPriority</code><!-- react-text: 379 --> will be used.<!-- /react-text --></p><p data-reactid="380">Any modification made to the connection at this stage may happen either before or after an action, and may or may not persist to the connection depending on how the server is implemented.</p></div></div></div><div data-reactid="381"><br data-reactid="382"/><h2 id="chat-middleware" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="383"><span style="font-weight:300;font-size:36px;" data-reactid="384">Chat Middleware</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="385"/><div style="font-family:Open Sans, sans-serif;" data-reactid="386"><div data-reactid="387"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="388"><code data-reactid="389"><span style="color:#333;font-weight:bold;" data-reactid="390"><!-- react-text: 391 -->var<!-- /react-text --></span><!-- react-text: 392 --> chatMiddleware = {
  <!-- /react-text --><span data-reactid="393"><!-- react-text: 394 -->name<!-- /react-text --></span><!-- react-text: 395 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="396"><!-- react-text: 397 -->&#x27;chat middleware&#x27;<!-- /react-text --></span><!-- react-text: 398 -->,
  <!-- /react-text --><span data-reactid="399"><!-- react-text: 400 -->priority<!-- /react-text --></span><!-- react-text: 401 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="402"><!-- react-text: 403 -->1000<!-- /react-text --></span><!-- react-text: 404 -->,
  <!-- /react-text --><span data-reactid="405"><!-- react-text: 406 -->join<!-- /react-text --></span><!-- react-text: 407 -->: <!-- /react-text --><span data-reactid="408"><span style="color:#333;font-weight:bold;" data-reactid="409"><!-- react-text: 410 -->function<!-- /react-text --></span><!-- react-text: 411 -->(<!-- /react-text --><span data-reactid="412"><!-- react-text: 413 -->connection, room, callback<!-- /react-text --></span><!-- react-text: 414 -->)<!-- /react-text --></span><!-- react-text: 415 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="416"><!-- react-text: 417 -->// announce all connections entering a room<!-- /react-text --></span><!-- react-text: 418 -->
    api.chatRoom.broadcast({}, room, <!-- /react-text --><span style="color:#d14;" data-reactid="419"><!-- react-text: 420 -->&#x27;I have joined the room: &#x27;<!-- /react-text --></span><!-- react-text: 421 --> + connection.id, callback);
  },
  <!-- /react-text --><span data-reactid="422"><!-- react-text: 423 -->leave<!-- /react-text --></span><!-- react-text: 424 -->: <!-- /react-text --><span data-reactid="425"><span style="color:#333;font-weight:bold;" data-reactid="426"><!-- react-text: 427 -->function<!-- /react-text --></span><!-- react-text: 428 -->(<!-- /react-text --><span data-reactid="429"><!-- react-text: 430 -->connection, room, callback<!-- /react-text --></span><!-- react-text: 431 -->)<!-- /react-text --></span><!-- react-text: 432 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="433"><!-- react-text: 434 -->// announce all connections leaving a room<!-- /react-text --></span><!-- react-text: 435 -->
    api.chatRoom.broadcast({}, room, <!-- /react-text --><span style="color:#d14;" data-reactid="436"><!-- react-text: 437 -->&#x27;I have left the room: &#x27;<!-- /react-text --></span><!-- react-text: 438 --> + connection.id, callback);
  },
  <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="439"><!-- react-text: 440 -->/**
   * Will be executed once per client connection before delivering the message.
   */<!-- /react-text --></span><!-- react-text: 441 -->
  say: <!-- /react-text --><span data-reactid="442"><span style="color:#333;font-weight:bold;" data-reactid="443"><!-- react-text: 444 -->function<!-- /react-text --></span><!-- react-text: 445 -->(<!-- /react-text --><span data-reactid="446"><!-- react-text: 447 -->connection, room, messagePayload, callback<!-- /react-text --></span><!-- react-text: 448 -->)<!-- /react-text --></span><!-- react-text: 449 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="450"><!-- react-text: 451 -->// do stuff<!-- /react-text --></span><!-- react-text: 452 -->
    api.log(messagePayload);
    callback(<!-- /react-text --><span style="color:#008080;" data-reactid="453"><!-- react-text: 454 -->null<!-- /react-text --></span><!-- react-text: 455 -->, messagePayload);
  },
  <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="456"><!-- react-text: 457 -->/**
   * Will be executed only once, when the message is sent to the server.
   */<!-- /react-text --></span><!-- react-text: 458 -->
  onSayReceive: <!-- /react-text --><span data-reactid="459"><span style="color:#333;font-weight:bold;" data-reactid="460"><!-- react-text: 461 -->function<!-- /react-text --></span><!-- react-text: 462 -->(<!-- /react-text --><span data-reactid="463"><!-- react-text: 464 -->connection, room, messagePayload, callback<!-- /react-text --></span><!-- react-text: 465 -->)<!-- /react-text --></span><!-- react-text: 466 -->{
    <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="467"><!-- react-text: 468 -->// do stuff<!-- /react-text --></span><!-- react-text: 469 -->
    api.log(messagePayload);
    callback(<!-- /react-text --><span style="color:#008080;" data-reactid="470"><!-- react-text: 471 -->null<!-- /react-text --></span><!-- react-text: 472 -->, messagePayload);
  }
};

api.chatRoom.addMiddleware(chatMiddleware);<!-- /react-text --></code></pre><p data-reactid="473"><!-- react-text: 474 -->The last type of middleware is used to act when a connection joins, leaves, or communicates within a chat room. We have 4 types of middleware for each step: <!-- /react-text --><code data-reactid="475">say</code><!-- react-text: 476 -->, <!-- /react-text --><code data-reactid="477">onSayReceive</code><!-- react-text: 478 -->, <!-- /react-text --><code data-reactid="479">join</code><!-- react-text: 480 -->, and <!-- /react-text --><code data-reactid="481">leave</code><!-- react-text: 482 -->.<!-- /react-text --></p><p data-reactid="483">Priority is optional in all cases, but can be used to order your middleware.  If an error is returned in any of these methods, it will be returned to the user, and the action/verb/message will not be sent.</p><p data-reactid="484"><!-- react-text: 485 -->More detail and nuance on chat middleware can be found in the <!-- /react-text --><a href="/docs/core/chat/" data-reactid="486">chat section</a></p><h3 data-reactid="487">Chat Midleware Notes</h3><ul data-reactid="488"><li data-reactid="489"><!-- react-text: 490 -->In the example above, I want to announce the member joining the room, but he has not yet been added to the room, as the callback chain is still firing.  If the connection itself were to make the broadcast, it would fail because the connection is not in the room.  Instead, an empty <!-- /react-text --><code data-reactid="491"></code><!-- react-text: 492 --> connection is used to proxy the message coming from the &#x27;system&#x27;<!-- /react-text --></li><li data-reactid="493"><!-- react-text: 494 -->Only the <!-- /react-text --><code data-reactid="495">sayCallbacks</code><!-- react-text: 496 --> have a second return value on the callback, <!-- /react-text --><code data-reactid="497">messagePayload</code><!-- react-text: 498 -->.  This allows you to modify the message being sent to your clients.<!-- /react-text --></li><li data-reactid="499"><code data-reactid="500">messagePayload</code><!-- react-text: 501 --> will be modified and and passed on to all <!-- /react-text --><code data-reactid="502">addSayCallback</code><!-- react-text: 503 --> middlewares inline, so you can append and modify it as you go<!-- /react-text --></li><li data-reactid="504"><!-- react-text: 505 -->If you have a number of callbacks (<!-- /react-text --><code data-reactid="506">say</code><!-- react-text: 507 -->, <!-- /react-text --><code data-reactid="508">onSayReceive</code><!-- react-text: 509 -->, <!-- /react-text --><code data-reactid="510">join</code><!-- react-text: 511 --> or <!-- /react-text --><code data-reactid="512">leave</code><!-- react-text: 513 -->), the priority maters, and you can block subsequent methods from firing by returning an error to the callback.<!-- /react-text --></li><li data-reactid="514"><code data-reactid="515">sayCallbacks</code><!-- react-text: 516 --> are executed once per client connection. This makes it suitable for customizing the message based on the individual client.<!-- /react-text --></li><li data-reactid="517"><code data-reactid="518">onSayReceiveCallbacks</code><!-- react-text: 519 --> are executed only once, when the message is sent to the server.<!-- /react-text --></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="520"><code data-reactid="521"><span style="color:#998;font-style:italic;" data-reactid="522"><!-- react-text: 523 -->// in this example no one will be able to join any room, and the `say` callback will never be invoked.<!-- /react-text --></span><!-- react-text: 524 -->

api.chatRoom.addMiddleware({
  <!-- /react-text --><span data-reactid="525"><!-- react-text: 526 -->name<!-- /react-text --></span><!-- react-text: 527 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="528"><!-- react-text: 529 -->&#x27;blocking chat middleware&#x27;<!-- /react-text --></span><!-- react-text: 530 -->,
  <!-- /react-text --><span data-reactid="531"><!-- react-text: 532 -->join<!-- /react-text --></span><!-- react-text: 533 -->: <!-- /react-text --><span data-reactid="534"><span style="color:#333;font-weight:bold;" data-reactid="535"><!-- react-text: 536 -->function<!-- /react-text --></span><!-- react-text: 537 -->(<!-- /react-text --><span data-reactid="538"><!-- react-text: 539 -->connection, room, callback<!-- /react-text --></span><!-- react-text: 540 -->)<!-- /react-text --></span><!-- react-text: 541 -->{
    callback(<!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="542"><!-- react-text: 543 -->new<!-- /react-text --></span><!-- react-text: 544 --> <!-- /react-text --><span style="color:#0086b3;" data-reactid="545"><!-- react-text: 546 -->Error<!-- /react-text --></span><!-- react-text: 547 -->(<!-- /react-text --><span style="color:#d14;" data-reactid="548"><!-- react-text: 549 -->&#x27;blocked from joining the room&#x27;<!-- /react-text --></span><!-- react-text: 550 -->));
  }),
  <!-- /react-text --><span data-reactid="551"><!-- react-text: 552 -->say<!-- /react-text --></span><!-- react-text: 553 -->: <!-- /react-text --><span data-reactid="554"><span style="color:#333;font-weight:bold;" data-reactid="555"><!-- react-text: 556 -->function<!-- /react-text --></span><!-- react-text: 557 -->(<!-- /react-text --><span data-reactid="558"><!-- react-text: 559 -->connection, room, messagePayload, callback<!-- /react-text --></span><!-- react-text: 560 -->)<!-- /react-text --></span><!-- react-text: 561 -->{
    api.chatRoom.broadcast({}, room, <!-- /react-text --><span style="color:#d14;" data-reactid="562"><!-- react-text: 563 -->&#x27;I have entered the room: &#x27;<!-- /react-text --></span><!-- react-text: 564 --> + connection.id, <!-- /react-text --><span data-reactid="565"><span style="color:#333;font-weight:bold;" data-reactid="566"><!-- react-text: 567 -->function<!-- /react-text --></span><!-- react-text: 568 -->(<!-- /react-text --><span data-reactid="569"><!-- react-text: 570 -->e<!-- /react-text --></span><!-- react-text: 571 -->)<!-- /react-text --></span><!-- react-text: 572 -->{
      callback();
    });
  },
});<!-- /react-text --></code></pre><p data-reactid="573"><!-- react-text: 574 -->If a <!-- /react-text --><code data-reactid="575">say</code><!-- react-text: 576 --> is blocked/errored, the message will simply not be delivered to the client.  If a <!-- /react-text --><code data-reactid="577">join</code><!-- react-text: 578 --> or <!-- /react-text --><code data-reactid="579">leave</code><!-- react-text: 580 --> is blocked/errored, the verb or method used to invoke the call will be returned that error.<!-- /react-text --></p></div></div></div><div data-reactid="581"><br data-reactid="582"/><h2 id="task-request-flow" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="583"><span style="font-weight:300;font-size:36px;" data-reactid="584">Task Request Flow</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="585"/><div style="font-family:Open Sans, sans-serif;" data-reactid="586"><div data-reactid="587"><img width="100%" src="/static/images/connection_flow_tasks.png" data-reactid="588"/></div></div></div><div data-reactid="589"><br data-reactid="590"/><h2 id="task-middleware" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="591"><span style="font-weight:300;font-size:36px;" data-reactid="592">Task Middleware</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px;" data-reactid="593"/><div style="font-family:Open Sans, sans-serif;" data-reactid="594"><div data-reactid="595"><p data-reactid="596"><!-- react-text: 597 -->Task middleware is implemented as a thin wrapper around Node Resque plugins and currently exposes the <!-- /react-text --><code data-reactid="598">before_perform</code><!-- react-text: 599 -->, <!-- /react-text --><code data-reactid="600">after_perform</code><!-- react-text: 601 -->, <!-- /react-text --><code data-reactid="602">before_enqueue</code><!-- react-text: 603 -->, and <!-- /react-text --><code data-reactid="604">after_enqueue</code><!-- react-text: 605 --> functions of Resque plugins through <!-- /react-text --><code data-reactid="606">preProcessor</code><!-- react-text: 607 -->, <!-- /react-text --><code data-reactid="608">postProcessor</code><!-- react-text: 609 -->,<!-- /react-text --><code data-reactid="610">preEnqueue</code><!-- react-text: 611 -->, and <!-- /react-text --><code data-reactid="612">postEnqueue</code><!-- react-text: 613 --> methods. Each middleware requires a <!-- /react-text --><code data-reactid="614">name</code><!-- react-text: 615 --> and at least one <!-- /react-text --><!-- react-text: 616 -->function<!-- /react-text --><!-- react-text: 617 -->. In addition, a middleware can be global, in which case it also requires a <!-- /react-text --><code data-reactid="618">priority</code><!-- react-text: 619 -->.<!-- /react-text --></p><p data-reactid="620"><!-- react-text: 621 -->In the <!-- /react-text --><code data-reactid="622">preProcessor</code><!-- react-text: 623 -->, you can access the original task <!-- /react-text --><code data-reactid="624">params</code><!-- react-text: 625 --> through <!-- /react-text --><code data-reactid="626">this.args[0]</code><!-- react-text: 627 -->. In the <!-- /react-text --><code data-reactid="628">postProcessor</code><!-- react-text: 629 -->, you can access the task result at <!-- /react-text --><code data-reactid="630">this.worker.result</code><!-- react-text: 631 -->. In the <!-- /react-text --><code data-reactid="632">preEnqueue</code><!-- react-text: 633 --> and <!-- /react-text --><code data-reactid="634">postEnqueue</code><!-- react-text: 635 --> you can access the task <!-- /react-text --><code data-reactid="636">params</code><!-- react-text: 637 --> through <!-- /react-text --><code data-reactid="638">this.args[0]</code><!-- react-text: 639 -->. If you wish to prevent a task from being enqueued using the <!-- /react-text --><code data-reactid="640">preEnqueue</code><!-- react-text: 641 --> middleware you must explicitly set the <!-- /react-text --><code data-reactid="642">toRun</code><!-- react-text: 643 --> value to <!-- /react-text --><code data-reactid="644">false</code><!-- react-text: 645 --> in the callback. Because the task middleware is executed by Resque <!-- /react-text --><code data-reactid="646">this</code><!-- react-text: 647 --> is an instance of a Resque Worker and contains a number of other elements which may be useful in a middleware.<!-- /react-text --></p><h3 data-reactid="648">Task Middleware Example</h3><p data-reactid="649">The following example is a simplistic implementation of a task execution timer middleware.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8;" data-reactid="650"><code data-reactid="651"><span style="color:#999;font-weight:bold;" data-reactid="652"><!-- react-text: 653 -->&#x27;use strict&#x27;<!-- /react-text --></span><!-- react-text: 654 -->;

<!-- /react-text --><span style="color:#0086b3;" data-reactid="655"><!-- react-text: 656 -->module<!-- /react-text --></span><!-- react-text: 657 -->.exports = {
  <!-- /react-text --><span data-reactid="658"><!-- react-text: 659 -->loadPriority<!-- /react-text --></span><!-- react-text: 660 -->:  <!-- /react-text --><span style="color:#008080;" data-reactid="661"><!-- react-text: 662 -->1000<!-- /react-text --></span><!-- react-text: 663 -->,
  <!-- /react-text --><span data-reactid="664"><!-- react-text: 665 -->initialize<!-- /react-text --></span><!-- react-text: 666 -->: <!-- /react-text --><span data-reactid="667"><span style="color:#333;font-weight:bold;" data-reactid="668"><!-- react-text: 669 -->function<!-- /react-text --></span><!-- react-text: 670 -->(<!-- /react-text --><span data-reactid="671"><!-- react-text: 672 -->api, next<!-- /react-text --></span><!-- react-text: 673 -->)<!-- /react-text --></span><!-- react-text: 674 -->{
    api.taskTimer = {
      <!-- /react-text --><span data-reactid="675"><!-- react-text: 676 -->middleware<!-- /react-text --></span><!-- react-text: 677 -->: {
        <!-- /react-text --><span data-reactid="678"><!-- react-text: 679 -->name<!-- /react-text --></span><!-- react-text: 680 -->: <!-- /react-text --><span style="color:#d14;" data-reactid="681"><!-- react-text: 682 -->&#x27;timer&#x27;<!-- /react-text --></span><!-- react-text: 683 -->,
        <!-- /react-text --><span data-reactid="684"><!-- react-text: 685 -->global<!-- /react-text --></span><!-- react-text: 686 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="687"><!-- react-text: 688 -->true<!-- /react-text --></span><!-- react-text: 689 -->,
        <!-- /react-text --><span data-reactid="690"><!-- react-text: 691 -->priority<!-- /react-text --></span><!-- react-text: 692 -->: <!-- /react-text --><span style="color:#008080;" data-reactid="693"><!-- react-text: 694 -->90<!-- /react-text --></span><!-- react-text: 695 -->,
        <!-- /react-text --><span data-reactid="696"><!-- react-text: 697 -->preProcessor<!-- /react-text --></span><!-- react-text: 698 -->: <!-- /react-text --><span data-reactid="699"><span style="color:#333;font-weight:bold;" data-reactid="700"><!-- react-text: 701 -->function<!-- /react-text --></span><!-- react-text: 702 -->(<!-- /react-text --><span data-reactid="703"><!-- react-text: 704 -->next<!-- /react-text --></span><!-- react-text: 705 -->)<!-- /react-text --></span><!-- react-text: 706 -->{
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="707"><!-- react-text: 708 -->var<!-- /react-text --></span><!-- react-text: 709 --> worker = <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="710"><!-- react-text: 711 -->this<!-- /react-text --></span><!-- react-text: 712 -->.worker;
          worker.start = process.hrtime();
          next();
        },
        <!-- /react-text --><span data-reactid="713"><!-- react-text: 714 -->postProcessor<!-- /react-text --></span><!-- react-text: 715 -->: <!-- /react-text --><span data-reactid="716"><span style="color:#333;font-weight:bold;" data-reactid="717"><!-- react-text: 718 -->function<!-- /react-text --></span><!-- react-text: 719 -->(<!-- /react-text --><span data-reactid="720"><!-- react-text: 721 -->next<!-- /react-text --></span><!-- react-text: 722 -->)<!-- /react-text --></span><!-- react-text: 723 -->{
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="724"><!-- react-text: 725 -->var<!-- /react-text --></span><!-- react-text: 726 --> worker = <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="727"><!-- react-text: 728 -->this<!-- /react-text --></span><!-- react-text: 729 -->.worker;
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="730"><!-- react-text: 731 -->var<!-- /react-text --></span><!-- react-text: 732 --> elapsed = process.hrtime(worker.start);
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="733"><!-- react-text: 734 -->var<!-- /react-text --></span><!-- react-text: 735 --> seconds = elapsed[<!-- /react-text --><span style="color:#008080;" data-reactid="736"><!-- react-text: 737 -->0<!-- /react-text --></span><!-- react-text: 738 -->];
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="739"><!-- react-text: 740 -->var<!-- /react-text --></span><!-- react-text: 741 --> millis = elapsed[<!-- /react-text --><span style="color:#008080;" data-reactid="742"><!-- react-text: 743 -->1<!-- /react-text --></span><!-- react-text: 744 -->] / <!-- /react-text --><span style="color:#008080;" data-reactid="745"><!-- react-text: 746 -->1000000<!-- /react-text --></span><!-- react-text: 747 -->;
          api.log(worker.job.class + <!-- /react-text --><span style="color:#d14;" data-reactid="748"><!-- react-text: 749 -->&#x27; done in &#x27;<!-- /react-text --></span><!-- react-text: 750 --> + seconds + <!-- /react-text --><span style="color:#d14;" data-reactid="751"><!-- react-text: 752 -->&#x27; s and &#x27;<!-- /react-text --></span><!-- react-text: 753 --> + millis + <!-- /react-text --><span style="color:#d14;" data-reactid="754"><!-- react-text: 755 -->&#x27; ms.&#x27;<!-- /react-text --></span><!-- react-text: 756 -->, <!-- /react-text --><span style="color:#d14;" data-reactid="757"><!-- react-text: 758 -->&#x27;info&#x27;<!-- /react-text --></span><!-- react-text: 759 -->);
          next();
        },
        <!-- /react-text --><span data-reactid="760"><!-- react-text: 761 -->preEnqueue<!-- /react-text --></span><!-- react-text: 762 -->: <!-- /react-text --><span data-reactid="763"><span style="color:#333;font-weight:bold;" data-reactid="764"><!-- react-text: 765 -->function<!-- /react-text --></span><!-- react-text: 766 -->(<!-- /react-text --><span data-reactid="767"><!-- react-text: 768 -->next<!-- /react-text --></span><!-- react-text: 769 -->)<!-- /react-text --></span><!-- react-text: 770 -->{
          <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="771"><!-- react-text: 772 -->var<!-- /react-text --></span><!-- react-text: 773 --> params = <!-- /react-text --><span style="color:#333;font-weight:bold;" data-reactid="774"><!-- react-text: 775 -->this<!-- /react-text --></span><!-- react-text: 776 -->.args[<!-- /react-text --><span style="color:#008080;" data-reactid="777"><!-- react-text: 778 -->0<!-- /react-text --></span><!-- react-text: 779 -->];
          <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="780"><!-- react-text: 781 -->//Validate params<!-- /react-text --></span><!-- react-text: 782 -->
          next(<!-- /react-text --><span style="color:#008080;" data-reactid="783"><!-- react-text: 784 -->null<!-- /react-text --></span><!-- react-text: 785 -->, <!-- /react-text --><span style="color:#008080;" data-reactid="786"><!-- react-text: 787 -->true<!-- /react-text --></span><!-- react-text: 788 -->); <!-- /react-text --><span style="color:#998;font-style:italic;" data-reactid="789"><!-- react-text: 790 -->//callback is in form cb(error, toRun)<!-- /react-text --></span><!-- react-text: 791 -->
        },
        <!-- /react-text --><span data-reactid="792"><!-- react-text: 793 -->postEnqueue<!-- /react-text --></span><!-- react-text: 794 -->: <!-- /react-text --><span data-reactid="795"><span style="color:#333;font-weight:bold;" data-reactid="796"><!-- react-text: 797 -->function<!-- /react-text --></span><!-- react-text: 798 -->(<!-- /react-text --><span data-reactid="799"><!-- react-text: 800 -->next<!-- /react-text --></span><!-- react-text: 801 -->)<!-- /react-text --></span><!-- react-text: 802 -->{
          api.log(<!-- /react-text --><span style="color:#d14;" data-reactid="803"><!-- react-text: 804 -->&quot;Task successfully enqueued!&quot;<!-- /react-text --></span><!-- react-text: 805 -->);
          next();
        }
      }
    };

    api.tasks.addMiddleware(api.taskTimer.middleware);
  }
};<!-- /react-text --></code></pre></div></div></div></div></div></div><div class="hidden-xs hidden-sm col-md-3" data-reactid="806"><div style="height:0;" data-reactid="807"><div data-reactid="808"><div data-reactid="809"></div><div style="padding-top:90px;" class="" data-reactid="810"><div data-reactid="811"><!-- react-empty: 812 --><div class="ais-InstantSearch__root" data-reactid="813"><form novalidate="" class="ais-SearchBox__root" action="" role="search" data-reactid="814"><svg xmlns="http://www.w3.org/2000/svg" style="display:none;" data-reactid="815"><symbol xmlns="http://www.w3.org/2000/svg" id="sbx-icon-search-13" viewBox="0 0 40 40" data-reactid="816"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z" fill-rule="evenodd" data-reactid="817"></path></symbol><symbol xmlns="http://www.w3.org/2000/svg" id="sbx-icon-clear-3" viewBox="0 0 20 20" data-reactid="818"><path d="M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z" fill-rule="evenodd" data-reactid="819"></path></symbol></svg><div role="search" class="ais-SearchBox__wrapper" data-reactid="820"><input type="search" placeholder="Search here…" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" required="" value="" class="ais-SearchBox__input" data-reactid="821"/><button type="submit" title="Submit your search query." class="ais-SearchBox__submit" data-reactid="822"><svg role="img" width="1em" height="1em" data-reactid="823"><use xlink:href="#sbx-icon-search-13" data-reactid="824"></use></svg></button><button type="reset" title="Clear the search query." class="ais-SearchBox__reset" data-reactid="825"><svg role="img" width="1em" height="1em" data-reactid="826"><use xlink:href="#sbx-icon-clear-3" data-reactid="827"></use></svg></button></div></form><div class="ais-Hits__root" data-reactid="828"></div></div><br data-reactid="829"/></div><ul style="list-style-type:none;padding-left:0;margin-left:0;" data-reactid="830"><li data-reactid="831"><a href="#overview" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="832">Overview</a></li><li data-reactid="833"><a href="#action-request-flow" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="834">Action Request Flow</a></li><li data-reactid="835"><a href="#action-middleware" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="836">Action Middleware</a></li><li data-reactid="837"><a href="#connection-middleware" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="838">Connection Middleware</a></li><li data-reactid="839"><a href="#chat-middleware" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="840">Chat Middleware</a></li><li data-reactid="841"><a href="#task-request-flow" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="842">Task Request Flow</a></li><li data-reactid="843"><a href="#task-middleware" class="text-info" style="font-weight:300;font-size:18px;line-height:1.6em;" data-reactid="844">Task Middleware</a></li></ul><br data-reactid="845"/><ul style="list-style-type:none;padding-left:0;margin-left:0;" data-reactid="846"><div data-reactid="847"><li data-reactid="848"><a style="font-weight:200;color:#E14E3A;" href="/docs/core/initializers/" data-reactid="849">» Core: Initializers</a></li><li data-reactid="850"><a style="font-weight:200;color:#E14E3A;" href="/docs/core/tasks/" data-reactid="851">« Core: Tasks</a></li></div><li data-reactid="852"><a href="#_top" style="font-weight:200;color:#E14E3A;" data-reactid="853">↑ Back to top</a></li></ul></div></div></div></div></div></div><div style="padding-bottom:100px;color:#2F5266;" data-reactid="854"><div class="container" data-reactid="855"><div class="row" data-reactid="856"><div style="text-align:center;" class="col-md-12" data-reactid="857"><hr style="color:#2F5266;background-color:#2F5266;border:0;height:2px;" data-reactid="858"/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="859"><span style="font-weight:400;" data-reactid="860">Up Next</span></h2><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72;" data-reactid="861"><a href="/docs/core/initializers/" data-reactid="862">Core: Initializers</a></h2></div></div></div></div></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300;" class="container-fluid" data-reactid="863"><footer id="footer-container" style="background-color:#2F5266;color:#FBF9E4;font-family:Roboto, sans-serif;font-weight:200;" data-reactid="864"><div class="container" data-reactid="865"><div style="padding-bottom:50px;padding-top:50px;padding-left:100px;" class="row" data-reactid="866"><div class="col-md-12" data-reactid="867"><img src="/static/images/actionhero-logo-header-wordmark.svg" data-reactid="868"/></div></div><div style="padding-bottom:100px;" class="row" data-reactid="869"><div class="col-md-4" data-reactid="870"><div style="padding-left:100px;" data-reactid="871"><p data-reactid="872"><a style="color:#FBF9E4;" href="/terms/" data-reactid="873">Terms</a></p><p data-reactid="874"><!-- react-text: 875 -->Contact us at <!-- /react-text --><a style="color:#FBF9E4;font-weight:500;" href="mailto:hello@actionherojs.com" data-reactid="876">hello@actionherojs.com</a></p><p data-reactid="877"><a target="_new" style="color:#FBF9E4;" href="https://medium.com/tag/actionherojs/" data-reactid="878">Blogs</a></p><p data-reactid="879"><!-- react-text: 880 -->© 2017<!-- /react-text --><!-- react-text: 881 --> ActionHero<!-- /react-text --></p><p data-reactid="882"><em data-reactid="883"><!-- react-text: 884 -->Search by <!-- /react-text --><a href="https://www.algolia.com" target="_new" data-reactid="885"><!-- react-text: 886 -->Algolia <!-- /react-text --><img style="padding:5px;" width="30" src="/static/images/algolia.svg" data-reactid="887"/></a></em></p></div></div><div class="col-md-4" data-reactid="888"><div style="padding-left:100px;" data-reactid="889"><p data-reactid="890"><a style="color:#FBF9E4;" href="/get-started/" data-reactid="891">Get Started</a></p><p data-reactid="892"><a style="color:#FBF9E4;" href="/docs/" data-reactid="893">Documenation</a></p><p data-reactid="894"><a style="color:#FBF9E4;" href="/solutions/" data-reactid="895">Solutions</a></p><p data-reactid="896"><a style="color:#FBF9E4;" href="/community/" data-reactid="897">Community</a></p><p data-reactid="898"><a style="color:#FBF9E4;" href="/downloads/" data-reactid="899">Downloads</a></p></div></div><div class="col-md-4" data-reactid="900"><div style="padding-left:100px;" data-reactid="901"><p data-reactid="902"><a target="_new" style="color:#FBF9E4;" href="https://www.npmjs.com/package/actionhero/" data-reactid="903">NPM</a></p><p data-reactid="904"><a target="_new" style="color:#FBF9E4;" href="https://twitter.com/actionherojs/" data-reactid="905">Twitter</a></p><p data-reactid="906"><a target="_new" style="color:#FBF9E4;" href="https://slack.actionherojs.com/" data-reactid="907">Slack</a></p><p data-reactid="908"><a target="_new" style="color:#FBF9E4;" href="https://github.com/actionhero/actionhero/" data-reactid="909">Github</a></p></div></div></div></div></footer></div></div></div></div><div id="__next-error"></div></div><div><script>
          __NEXT_DATA__ = {"props":{},"pathname":"/docs/core/middleware","query":{},"buildId":"e2246878-227f-4809-bcfe-8b4d3e2ec98c","buildStats":{"app.js":{"hash":"517642acd6437ad7e589c92138f402c3"}},"assetPrefix":"","nextExport":true,"err":null,"chunks":[]}
          module={}
          __NEXT_LOADED_PAGES__ = []
          __NEXT_LOADED_CHUNKS__ = []

          __NEXT_REGISTER_PAGE = function (route, fn) {
            __NEXT_LOADED_PAGES__.push({ route: route, fn: fn })
          }

          __NEXT_REGISTER_CHUNK = function (chunkName, fn) {
            __NEXT_LOADED_CHUNKS__.push({ chunkName: chunkName, fn: fn })
          }
        </script><script async="" id="__NEXT_PAGE__/docs/core/middleware" type="text/javascript" src="/_next/e2246878-227f-4809-bcfe-8b4d3e2ec98c/page/docs/core/middleware/index.js"></script><script async="" id="__NEXT_PAGE__/_error" type="text/javascript" src="/_next/e2246878-227f-4809-bcfe-8b4d3e2ec98c/page/_error/index.js"></script><div></div><script type="text/javascript" src="/_next/517642acd6437ad7e589c92138f402c3/app.js" async=""></script></div></body></html>